<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<META name="GENERATOR" content="IBM HomePage Builder 2001 V5.0.0 for Windows">
<META http-equiv="Content-Style-Type" content="text/css">
<TITLE>プログラミング関係リンク・C/C++/API 微妙Tipsプログラミング関係リンク・C/C++/API
微妙Tips</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=x-sjis">
<META name="GENERATOR" content="IBM HomePage Builder 2001 V5.0.0 for Windows">
</HEAD>
<BODY background="1052.gif" bgcolor="#ffffff" text="#000000" vlink="#808080" alink="#0000ff" link="#191970">
<P align="center"><FONT color="#0000FF" size="6"><STRONG>プログラミング関係リンク</STRONG></FONT><FONT color="#0000FF" size="6"><STRONG>・C/C++/API微妙Tips</STRONG></FONT></P>
<P><BR>
<A href="http://www.amazon.co.jp/exec/obidos/ASIN/4061497650/sml-22"><IMG src="kagakusuru.jpg" width="72" height="120" border="0"></A><FONT color="#FF0000"><SCRIPT type="text/javascript"><!--
google_ad_client = "pub-0849366231331886";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel ="";
//--></SCRIPT> <SCRIPT type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</SCRIPT> <BR>
<BR>
</FONT><BR>
<B><FONT size="+2">・リンク</FONT></B><BR>
<BR>
<BR>
Borland C++ Builder関係<BR>
<A href="http://www.borland.co.jp/"><FONT color="#0000FF">Borland ホームページ</FONT></A><BR>
<A href="http://www.sfdata.ne.jp/windev/cbuilder/index.html"><U><FONT color="#0000FF">BuilderＭＬ</FONT></U></A><BR>
<A href="http://www.sfdata.jp/ML/menu.php?ml=cbuilder"><U><FONT color="#0000FF">新BuilderＭＬ</FONT></U></A><BR>
<A href="http://www.delphianworld.com/"><FONT color="#0000FF"><U>Delphian World</U></FONT></A>　コンポーネント検索<FONT size="4">　<BR>
</FONT><A href="http://www.microsoft.com/japan/msdn/default.asp"><U><FONT color="#0000FF">MSDN</FONT></U></A><BR>
<BR>
<BR>
API<BR>
<A href="http://www.biwa.ne.jp/~chu0296/"><U><FONT color="#0000FF">Classょょょ</FONT></U></A>　BuilderとAPIの役立つTips<BR>
<FONT size="3"><A href="http://homepage1.nifty.com/MADIA/"><U><FONT color="#0000FF">読みやすいAPI解説</FONT></U></A><BR>
<BR>
</FONT><BR>
暗号<BR>
<A href="http://www.itl.nist.gov/fipspubs/fip180-1.htm"><U><FONT color="#0000FF">SHA-1元資料（FIPS180-1）</FONT></U></A><BR>
<A href="http://csrc.nist.gov/cryptval/shs.html"><U><FONT color="#0000FF">SecureHashStandard</FONT></U></A>　SHAに関する資料<BR>
<A href="http://www.know.comp.kyutech.ac.jp/BPCS/"><U><FONT color="#0000FF">ステガノグラフィー</FONT></U></A><BR>
<FONT color="#0000FF"><U><A href="http://www-6.ibm.com/jp/developerworks/security/000915/j_everything.html"><FONT color="#0000FF">IBMのセキュリティページ・暗号の動向</FONT></A></U></FONT><BR>
<A href="http://www8.big.or.jp/~000/CyberSyndrome/index.html"><U><FONT color="#0000FF">RSAの基礎</FONT></U></A>（細かい解説）<BR>
<A href="http://www.math.s.kobe-u.ac.jp/HOME/taka/asir-book-html/main/"><U><FONT color="#0000FF">RSAと他のいくつかの話題<BR>
</FONT></U></A><A href="http://204.167.114.22/"><U><FONT color="#0000FF">RSA　Security</FONT></U></A>（<A href="http://www.rsasecurity.com/rsalabs/pkcs/"><U><FONT color="#0000FF">PKCS</FONT></U></A>）<BR>
<A href="http://www.maitou.gr.jp/rsa/"><U><FONT color="#0000FF">サルにもわかるRSA</FONT></U></A>（入門用、他のコンテンツで割と笑える）<BR>
<A href="http://www.infoscience.co.jp/technical/openssl/"><U><FONT color="#0000FF">OpenSSL</FONT></U></A><BR>
<U><FONT color="#0000FF"><A href="http://hp.vector.co.jp/authors/VA007786/jpz.html"><FONT color="#0000FF"><FONT color="#0000FF">BlowFish</FONT></FONT></A><BR>
</FONT></U><A href="http://www.esat.kuleuven.ac.be/~rijmen/rijndael/"><U><FONT color="#0000FF">Rijndeal</FONT></U></A>（英語）<BR>
<A href="http://fp.gladman.plus.com/cryptography_technology/rijndael/"><U><FONT color="#0000FF">Rijndeal</FONT></U></A>（英語・ソースあり）<BR>
<BR>
<BR>
圧縮<BR>
<A href="http://member.nifty.ne.jp/DO/index.htm"><U><FONT color="#0000FF">BrockSortingとRangeCorderの入門・ソース（どぅぷらぷら）</FONT></U></A><BR>
<U><FONT color="#0000FF"><A href="http://member.nifty.ne.jp/yamazaki/"><FONT color="#0000FF">DeepFreezer</FONT></A></FONT></U>　（「データ圧縮の基礎」など基礎読み物あり）<BR>
<A href="http://www.emit.jp/gca/gca.html"><U><FONT color="#0000FF">GCA</FONT></U></A>　（高圧縮）<BR>
<A href="http://upx.sourceforge.net/"><U><FONT color="#0000FF">UPX</FONT></U></A>　（exe　compression）<BR>
<BR>
<BR>
乱数<BR>
<U><A href="http://www-6.ibm.com/jp/developerworks/security/000818/j_playing.html"><FONT color="#0000FF">IBM記事</FONT></A></U><BR>
<A href="http://stat.fsu.edu/~geo/diehard.html"><U><FONT color="#0000FF"><FONT color="#0000FF">DIEHARD</FONT></FONT></U></A><BR>
<A href="http://www.math.keio.ac.jp/~matumoto/mt.html"><FONT color="#0000FF">Mersenne Twister Home Page</FONT></A>　2^19937-1周期の良質・高速な乱数<BR>
<A href="http://fapsis.s1.xrea.com/"><U><FONT color="#0000FF">パスワード評価ツール</FONT></U></A>　ちょっと楽しめます<BR>
<BR>
<BR>
良質なソースや高度なところ<BR>
<A href="http://www5.airnet.ne.jp/tomy/cpro/csource.htm"><U><FONT color="#0000FF">技術計算用Cソース</FONT></U></A><BR>
<A href="http://www.emit.jp/"><U><FONT color="#0000FF">とってもごはん</FONT></U></A>　上のGCAもここのコンテンツ。非常に高度かつ良質です。<BR>
<A href="http://www.sun-inet.or.jp/~yaneurao/"><U><FONT color="#0000FF">やねうらお氏のとこ</FONT></U></A>　高度。鬼知識。神。<BR>
<BR>
<BR>
（備考）<BR>
<A href="http://home.att.ne.jp/yellow/hide_n/"><U><FONT color="#0000FF">QueryPerformanceCountの問題</FONT></U></A><BR>
<FONT color="#0000FF"><U><A href="http://www.emit.jp/prog/prog_t1.html"><FONT color="#0000FF">timeGetTimeの誤差について</FONT></A></U><BR>
</FONT><BR>
<BR>
ツール類<BR>
<A href="http://www.forest.impress.co.jp/"><U><FONT color="#0000FF">窓の杜</FONT></U></A>　（あらゆるオンラインソフト）<BR>
<A href="http://www.nx.sakura.ne.jp/~elysium/software/top.html"><U><FONT color="#0000FF">バイナリエディタPowerWitch</FONT></U></A><BR>
<A href="http://www.kmkz.jp/mtm/"><U><FONT color="#0000FF">逆アセンブラDispe</FONT></U></A><BR>
<A href="http://www.zdnet.co.jp/download/pc/tools/memocalc.html"><U><FONT color="#0000FF">めも電卓</FONT></U></A>　（少々面倒な計算をしたい時に非常に役立つ）<BR>
<BR>
<BR>
その他・一般<BR>
<A href="http://www.hotwired.co.jp/news/"><U><FONT color="#0000FF">WiredNEWS</FONT></U></A>　テクノロジー関係の最新ニュースが日本語で読める。<BR>
<A href="http://www.catnet.ne.jp/kouno/c_faq/c_faq.html"><U><FONT color="#0000FF">C FAQ日本語訳</FONT></U></A><BR>
<A href="http://www.trendmicro.co.jp/virusinfo/index.asp"><U><FONT color="#0000FF">トレンドマイクロ</FONT></U></A>（ウイルス検索など）<BR>
<A href="http://ruffnex.oc.to/ipusiron/top.htm"><U><FONT color="#0000FF">セキュリティ</FONT></U></A>（<A href="http://ruffnex.oc.to/ipusiron/ug_lect.htm"><U><FONT color="#0000FF">セキュリティレクチャー</FONT></U></A>）<BR>
<U><A href="http://www.murashima.matsudo.chiba.jp/mura/ReadersPage.htm"><FONT color="#0000FF">TCP/IPポート番号一覧</FONT></A></U>　<FONT size="3"><BR>
</FONT><FONT color="#0000FF"><U><A href="http://www2s.biglobe.ne.jp/~yamadai/"><FONT color="#0000FF">Discover SOFT</FONT></A></U></FONT>　N88-BASICとほぼ上位互換の、Windowsアプリケーション開発用コンパイラ（フリー）<BR>
<A href="http://www.microsoft.com/japan/developer/net/framework/dnmag_framework.asp"><FONT color="#0000FF">.NETフレームワーク概要リンク</FONT></A><BR>
<FONT color="#0000FF"><A href="http://www.kumei.ne.jp/c_lang/"><U><FONT color="#0000FF">猫でもわかるプログラミング</FONT></U></A></FONT><B><FONT size="+1">　</FONT></B><FONT size="3"><BR>
</FONT><U><A href="http://tohoho.wakusei.ne.jp/wwwperl.htm"><FONT color="#0000FF">とほほのperl入門</FONT></A></U><BR>
<BR>
<BR>
法律関係<BR>
<A href="http://law.e-gov.go.jp/cgi-bin/idxsearch.cgi"><U><FONT color="#0000FF">法令データ提供システム（総務省　行政管理局）</FONT></U></A><BR>
<A href="http://law.e-gov.go.jp/cgi-bin/idxselect.cgi?IDX_OPT=1&H_NAME=%95%73%90%b3%83%41%83%4e%83%5a%83%58&H_NAME_YOMI=%82%a0&H_NO_GENGO=H&H_NO_YEAR=&H_NO_TYPE=2&H_NO_NO=&H_FILE_RECNO=953&H_RYAKU=1&H_CTG=1&H_YOMI_GUN=1&H_CTG_GUN=1"><U><FONT color="#0000FF">不正アクセス防止法</FONT></U></A><BR>
<A href="http://www.meti.go.jp/kohosys/press/0001228/0/1226ec.html"><U><FONT color="#0000FF">経済産業省の暗号ソフト規制緩和についての情報（04
Apr 2001 00:43:25 ）</FONT></U></A><BR>
<A href="http://www.meti.go.jp/kohosys/press/0000711/2/ex-rev3.htm"><U><FONT color="#0000FF">経済産業省の暗号ソフト規制緩和についての情報（04
Apr 2001 00:51:10 ）</FONT></U></A><BR>
<BR>
<BR><BR>
<FONT color="#FF0000"><SCRIPT type="text/javascript"><!--
google_ad_client = "pub-0849366231331886";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel ="";
//--></SCRIPT> <SCRIPT type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</SCRIPT> </FONT><BR>
<BR>
<BR>
<B><FONT size="+2">・テクニック及び知識</FONT></B><BR>
<BR>
コンパイラ依存とかの細かいことは責任持ちません(笑)が、まあどれでもほぼ同じ動作と思います。<BR>
以下は少なくともBorland C++ Builder＋Win32
APIで動作します。<BR>
<BR>
<BR>
<FONT size="+2"><B>暗号ソフトを作るには？</B></FONT><BR>
<BR>
<FONT color="#0000FF"><U><B><FONT size="+1"><A href="crypt.htm"><FONT color="#0000FF">暗号ソフトをデザインしてみる</FONT></A></FONT></B></U></FONT><BR>
<BR>
<BR>
<FONT size="+2"><B>暗号に関する輸出規制については？</B></FONT><BR>
<BR>
<FONT color="#FF0000">基本的に、暗号ソフト・ソースの輸出やネットワーク上での公開のためには、外国為替及び外国貿易法に基づき大臣の許可が必要である。</FONT><BR>
以前は特に制限が厳しかったが、緩和されたそうなので以下の情報を参照。<BR>
<BR>
<A href="http://www.meti.go.jp/kohosys/press/0001228/0/1226ec.html"><U><FONT color="#0000FF">経済産業省の暗号ソフト規制緩和についての情報（04
Apr 2001 00:43:25 ）</FONT></U></A><BR>
「<BR>
（概要） <BR>
　ＷＡにおける合意を受けて、通商産業省告示（輸出貿易管理令第４条第１項第５号の規定に基づき、通商産業大臣が告示で定める貨物を定める件）により、これまで許可の対象外となっていた大量市販暗号製品に係る要件のうち、対称アルゴリズムの鍵長の要件を撤廃。
<BR>
　 <BR>
　これにより、<B>鍵長が６４ビットを超える対称アルゴリズムを用いる暗号製品であっても、購入に際し何ら制限を受けず、暗号機能が使用者によって変更ができない等の要件を満たせば、規制対象外となる。</B>具体的には、これらの要件を満たせば、鍵長が６４ビットを超える対称アルゴリズムを有するブルートゥース等の暗号製品であっても、今後は規制対象外となる。
<BR>
　 <BR>
　また、今回の措置により、これまで第２種一般包括輸出許可の対象となっていた暗号製品の一部が規制対象外となることから、暗号製品に係る第２種一般包括許可の適用範囲の改正を行った。
<BR>
　 <BR>
（改正部分） <BR>
・輸出貿易管理令第４条第１項第５号の規定に基づき、通商産業大臣が告示で定める貨物を定める件（平成１１年通商産業省告示第３５３号）（改正）
<BR>
・その他包括関係通達（改正） <BR>
」<BR>
<BR>
<A href="http://www.meti.go.jp/kohosys/press/0000711/2/ex-rev3.htm"><U><FONT color="#0000FF">経済産業省の暗号ソフト規制緩和についての情報（04
Apr 2001 00:51:10 ）</FONT></U></A><BR>
「<BR>
（概要） <BR>
　使用に際して供給者の技術支援が不要であるように設計されたプログラム（暗号プロ
<BR>
グラムの場合には、技術支援が不要であり、かつ暗号機能が変更できず、鍵長が６４ビッ
<BR>
トを超えないもの）をネットワーク上にアップロードすることにより、不特定多数の者
<BR>
が何ら制限されず入手可能な状態とする行為については、外為法第２５条第１項の役務
<BR>
取引許可を要しないものとする。 <BR>
　 <BR>
　<B>また、購入に際して何ら制限なく販売（有償）される等の暗号製品・プログラムに加
<BR>
え、無償で提供されるものについても、有償のものと同様に扱う</B>こととし、通商産業大 <BR>
臣の許可を不要とする又は包括許可の対象とするとの規制緩和を実施。
<BR>
　 <BR>
　<B>これらにより、インターネットを通じたプログラムの提供について、大幅に規制が緩
<BR>
和</B>されることとなる。 <BR>
　 <BR>
（改正部分） <BR>
・外国為替及び外国貿易法第２５条第１項第１号の規定に基づき許可を要する技術を提
<BR>
　供する取引について（通達改正） <BR>
・一般包括輸出許可等について（輸出注意事項８第２１号、改正）
<BR>
」<BR>
<BR>
要約。<BR>
・購入に際し何ら制限を受けず、暗号機能が使用者によって変更ができない等の要件を満たした対称鍵暗号法の大量市販暗号製品については鍵長の制限なし。<BR>
・技術支援が不要であり、かつ暗号機能が変更できず、鍵長が６４ビットを超えないものをネットワーク上にアップロードすることにより、不特定多数の者が何ら制限されず入手可能な状態とする行為については、外為法第２５条第１項の役務取引許可を要しない。<BR>
・購入に際して何ら制限なく販売（有償）される等の暗号製品・プログラムに加え、無償で提供されるものについても、有償のものと同様に扱う。<BR>
<BR>
<FONT color="#FF0000">暗号ルーチンのソースコードを公開することは、「暗号機能が変更できる」のでダメ</FONT>らしい（たくさん公開されてるが・・・笑）。<BR>
いぜん、<FONT color="#FF0000">鍵長64ビットを超える暗号システムをネットワークを通じて公開することはダメ</FONT>らしい（これもだが・・・）。<BR>
アメリカ等の方式に比べて、日本は「状況による」ことが多いようだ。個別に審査される必要がある場合が多いらしい。<BR>
どこからが規制にひっかかるかが難しい。<BR>
単純に乱数とのXORを取るルーチンでも、擬似乱数の周期を増やせば簡単に鍵長64ビット超えるように改良できるしなぁ。<BR>
とりあえず、<FONT color="#FF0000">鍵長を64ビット以下に固定した暗号の、通常のプログラムをアップするのはＯＫ</FONT>なようだ（全然守られてないですが・・・涙）。<BR>
<BR>
なお、上の記述には間違いがない保証はしない。したがって上の記述を鵜呑みにして行動して違反した場合などの損害に、とつげき東北は一切責任を負わない。<BR>
情報が少なくて（分散していて）集めにくく、間違っているかもしれない。もし詳しい人がいたらぜひ教えてください。<BR>
当然、とつげき東北は違法な行為をしたくないので、このガイドラインを常に守る方針でいきます。<BR>
<BR>
<BR>
<FONT size="+2"><B>「ランダムな乱数」「良質な乱数」を得るには？</B></FONT><BR>
<BR>
<U><A href="hdrand.htm"><B><FONT color="#0000FF" size="+1">こちらを参照</FONT></B></A></U><BR>
<BR>
<BR>
<B><FONT size="+2">高分解能パフォーマンスカウンタの使い方</FONT></B><BR>
<BR>
timeGetTimrなどでは充分な精度の時間処理ができない。<BR>
パフォーマンスカウンタを使おう。<BR>
<BR>
<B>BOOL QueryPerformanceFrequency(lpliPerformanceFreq)</B><BR>
LARGE_INTEGER *lpliPerformanceFreq; /* 現在の頻度のアドレス
*/ <BR>
<BR>
QueryPerformanceFrequency関数は､ 高分解能パフォーマンス
カウンタが存在する場合に､ その頻度を取得します。<BR>
<BR>
パラメータ 説明<BR>
lpliPerformanceFreq 関数が現在のパフォーマンス
カウンタの頻度 (カウント毎秒単位) を設定する変数を指すポインタです。インストールされているハードウェアが高分解能パフォーマンス
カウンタをサポートしていない場合､ lpliPerformanceFreqは0に設定されます。<BR>
<BR>
戻り値<BR>
インストールされているハードウェアが高分解能パフォーマンス
カウンタをサポートしている場合は､ TRUEを返します。それ以外の場合は､
FALSEを返します。拡張エラー情報を取得するには､
GetLastError関数を使います。<BR>
<BR>
<BR>
<B>BOOL QueryPerformanceCounter(lpliPerformanceCount)</B><BR>
LARGE_INTEGER *lpliPerformanceCount; /* 現在のカウンタ値のアドレス
*/ <BR>
<BR>
QueryPerformanceCounter関数は､ 高分解能パフォーマンス
カウンタが存在する場合に､ その現在値を取得します。<BR>
<BR>
パラメータ 説明<BR>
lpliPerformanceCount 関数が現在のパフォーマンス
カウンタ値 (カウント単位) を設定する変数を指すポインタです。インストールされているハードウェアが高分解能パフォーマンス
カウンタをサポートしていない場合､ <BR>
lpliPerformanceCountは0に設定されます。<BR>
<BR>
<BR>
戻り値<BR>
インストールされているハードウェアが高分解能パフォーマンス
カウンタをサポートしている場合は､ TRUEを返します。それ以外の場合は､
FALSEを返します。拡張エラー情報を取得するには､
GetLastError関数を使います。<BR>
<BR>
<B>実装例</B><BR>
<BR>
//｛処理｝にかかる時間を計測するコード<BR>
<BR>
_LARGE_INTEGER l; //高分解能パフォーマンスカウンタのカウント値参照用<BR>
DWORD t; //同カウント値保持用<BR>
QueryPerformanceCounter(&amp;l); //開始時刻<BR>
t=l.LowPart;<BR>
<BR>
//時間を計測する処理を記述<BR>
<BR>
QueryPerformanceCounter(&amp;l); //終了時刻<BR>
ShowMessage(l.LowPart-t);<BR>
<BR>
<BR>
<B><FONT size="+2">ファイルをメモリ上で直接いじるAPIを使うには？</FONT></B><BR>
<BR>
一気にメモリ上に読んでしまっていじる方法。<BR>
逐次読み込み式より早く、また一括で全体のデータを利用しなければならない場合に便利。<BR>
テキストファイルなら、\0を最後につけて、全体をAnsiStringに代入することも可能。<BR>
<BR>
<B>実装例：</B><BR>
<BR>
AnsiString Filenamestr=&quot;test.txt&quot;;<BR>
char filename[MAX_PATH];<BR>
strcpy(filename,Filenamestr.c_str());<BR>
char *cBUF;<BR>
HANDLE hFILE;<BR>
DWORD wFSIZE,wGSIZE;<BR>
<BR>
// ファイルを開く<BR>
hFILE = ::CreateFile(filename,GENERIC_READ,FILE_SHARE_READ,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,0);<BR>
// ファイルサイズの取得<BR>
wFSIZE = ::GetFileSize(hFILE,NULL);<BR>
// ファイルサイズが0xFFFFFFFFの場合はファイルオープン失敗<BR>
if (wFSIZE != 0xFFFFFFFF) {<BR>
// メモリを確保する<BR>
cBUF = (char*)malloc(wFSIZE + 1); <BR>
// ファイルを一括で読込む<BR>
::ReadFile(hFILE,cBUF,wFSIZE,&amp;wGSIZE,NULL);<BR>
// ファイルを閉じる<BR>
::CloseHandle(hFILE);<BR>
<BR>
//・・・処理・・・<BR>
//cBUFがデータの先頭を指すポインタ。<BR>
//よ〜わからん人は、おなじみのfopenを使って、例えば次のようにやってみるといい。<BR>
//APIリファレンスを見てればわかると思うけど。<BR>
FILE *out;<BR>
out2=fopen(&quot;test2.txt&quot;,&quot;wb&quot;);<BR>
fwrite(cBUF,1,wFSIZE,out); <BR>
fclose(out);<BR>
//これで「test.txt」が「test2.txt」にコピーされる（stdio.hをインクルードすること）。<BR>
<BR>
// メモリの解放<BR>
free(cBUF);<BR>
}<BR>
<BR>
<BR>
<B><FONT size="+1">指定ディレクトリ以下に存在する全てのファイルを列挙するには？（C++Builder）</FONT></B><BR>
<BR>
WIN32APIのFindFirstFile関数等をラップするVCLのFindFirst関数を再帰的に適用する。<BR>
なお、ヘルプにある属性以外の属性のファイルもあるようで、全てのファイルを列挙するためには、ヘルプに記述されている「全てのファイル」属性0x3fではなく0xffを用いる必要がある（；´Д`）。<BR>
ディレクトリ下のファイル数判定のための変数など入れてあるが、ここでは使っていない。各自カスタマイズして使うこと。<BR>
下の実装例は、c:\以下の全てのファイルをLabel1に順に表示するもの。<BR>
<BR>
<B>実装例：</B>（各自適当にカスタマイズして用いること）<BR>
<BR>
static int filename=0;<BR>
<BR>
int TForm1::EnumDirectoryFile(AnsiString
dir) //dirとして与えられたディレクトリ下の全てのファイルを列挙する<BR>
{<BR>
int internalfilenum=0;<BR>
AnsiString zenkaidirstr;<BR>
TSearchRec sr;<BR>
static int iAttributes = 0xff;<BR>
if (FindFirst(dir+&quot;\\*.*&quot;, iAttributes,
sr) == 0)<BR>
{<BR>
do<BR>
{<BR>
if ((sr.Attr &amp; iAttributes) == sr.Attr)<BR>
{<BR>
if((sr.Name!=&quot;..&quot;)&amp;&amp;(sr.Name!=&quot;.&quot;))<BR>
{<BR>
if(sr.Attr&amp;0x10)<BR>
{<BR>
EnumDirectoryFile(dir+&quot;\\&quot;+sr.Name);<BR>
}<BR>
else<BR>
{<BR>
filenum++;<BR>
internalfilenum++;<BR>
Label1-&gt;Caption=(dir+&quot;\\&quot;+sr.Name);//表示<BR>
}<BR>
}<BR>
}<BR>
} while (FindNext(sr) == 0);<BR>
FindClose(sr);<BR>
}<BR>
Application-&gt;ProcessMessages();//表示の更新<BR>
return internalfilenum;<BR>
}<BR>
<BR>
void __fastcall TForm1::Button1Click(TObject
*Sender)<BR>
{<BR>
EnumDirectoryFile(&quot;c:&quot;);<BR>
ShowMessage(filenum);<BR>
}<BR>
<BR>
<BR>
<BR>
<A href="func.htm"><B><FONT color="#0000FF">時々使いそうな関数</FONT></B></A><BR>
毎回何か組むたびに作ってる気がするようなルーチンを。<BR>
<BR>
<BR>
<BR>
<B><FONT size="+2" color="#0000FF">・微妙な小技</FONT></B><BR>
<BR>
<B><FONT size="5">「分母が０の時分子も０になる」条件の下で０除算を避けるには？<BR>
</FONT></B><BR>
Ｘ／Ｙ　を　Ｘ／（Ｙ＋DELTA）　に置き換える。DELTAは、Ｙに対して充分小さい負の小数。例えば-0.001。<BR>
リーチ何回中何回成功したか（リーチ成功率）などの集計の場合には、リーチ数自体が０である場合、リーチ成功率も「０」と表示してしまえば良いと思われる。しかもこれ系のデータは大量に出すので、いちいち分母で場合分けするのはめんどう。<BR>
そこで上のようにする。<BR>
Ｙが０の時も０除算にならずに計算は実行されるが、「〜回中〜回」のように、分母が０なら必ず分子も０になるような計算であれば、結局結果は０になる。<BR>
ただしDELTAを正にすると、型によっては大きな誤差になるので注意（例えば結果がintなら1/1.001＝０になるね）。<BR>
また「分母が０の時分子も０になる」条件のない計算には使えないことは明らか。<BR>
#define DELTA -0.001　などにしておくと便利。<BR>
<BR>
<BR>
<FONT size="5"><B>「分母が０の時分子も０になる」条件がない場合に０除算を避けるには？</B><BR>
</FONT><BR>
Ｚ＝Ｘ／Ｙ　を　Ｚ＝Ｙ？（Ｘ／Ｙ）：Ｚzero　に置き換える。ＺzeroはＹが０の時にＺに代入したい値。<BR>
Ｙが真（０以外）である時Ｚの値は（Ｘ／Ｙ）となり、そうでない時（Ｙ＝０）Ｚの値はＺzeroとなる。<BR>
集計ツールで全ての「率計算」ごとにｉｆ文を書いていたらソースが汚くなる。<BR>
<BR>
<BR>
<BR>
<FONT size="-1"><B><FONT size="+1" color="#0000FF">・よくあるTips（ほぼ個人メモ用）</FONT></B><BR>
</FONT><FONT size="-1"><BR>
</FONT><FONT size="4"><STRONG>フォームのメモリを動的に確保するには？</STRONG></FONT><FONT size="2">一応以下のコードはC++Builder専用)</FONT><FONT size="4"><BR>
</FONT><FONT size="-1"><BR>
Formxという名前のフォームを作成<BR>
Formx = new TForm(this);<BR>
</FONT><FONT size="-1"><BR>
メモリ解放<BR>
void __fastcall TFormx::FormClose(TObject
*Sender, TCloseAction &amp;Action){Action
= caFree;}<BR>
</FONT><FONT size="-1"><BR>
プロジェクト−オプション−フォーム　で、Formxを「選択可能なフォーム」にしておくこと。<BR>
</FONT><FONT size="-1"><BR>
</FONT><FONT size="-1"><BR>
</FONT><FONT size="4"><STRONG>TEditBoxで数値の入力以外を蹴るには？<BR>
</STRONG></FONT><FONT size="-1"><BR>
各エディットボックスの　OnKeyPressイベントに、以下を追加する。<BR>
</FONT><FONT size="-1"><BR>
if((Key!=VK_BACK)&amp;&amp;(Key!=VK_DELETE)&amp;&amp;(
Key &lt; '0' || Key &gt; '9' )) Key = NULL;</FONT><BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
</P>
</BODY>
</HTML>