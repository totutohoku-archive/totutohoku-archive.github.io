<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<meta charset="UTF-8">
<META name="GENERATOR" content="IBM HomePage Builder 2001 V5.0.0 for Windows">
<TITLE>WinPTA－安全な運用方法に関するヒント</TITLE>
</HEAD>
<BODY background="1052.gif" alink="#ff0000" bgcolor="#ffffd2" link="#0000ff" text="#000000" vlink="#880088">
<P><B><FONT size="+3"><IMG src="WINPTA.gif" width="32" height="32" border="0">WinPTA</FONT><FONT size="+1">　</FONT><FONT size="+3">安全な運用方法に関するヒント</FONT></B><B>　とつげき東北</B>　<U><FONT color="#0000FF"><A href="/hp/">TOP</A></FONT></U><BR>
<BR>
<BR>
<BR>
<B><FONT size="+2">WinPTAの安全な運用の程度</FONT></B><BR>
<BR>
どのような条件下で、WinPTAがどの程度安全に運用できるかをまとめてみます。<BR>
<BR>
<BR>
<B>レベル0：<FONT color="#0000FF">充分に安全</FONT></B><BR>
<B><BR>
状況：</B><BR>
WinPTAの存在もログファイルの存在も第三者に知られておらず、WinPTAの実行に関する何の警戒もされていない。<BR>
<B>ユーザのレベル：</B><BR>
たとえば、せいぜい週に1回くらい市販のウイルスチェックソフトでウイルス検査をするだけで「PCは安全だろう」と考えているような、通常の、ノーマルなPCユーザに対する運用例です。<BR>
<B>WinPTAの運用：</B><BR>
これに対して、WinPTAは完全に安全に運用されます。<BR>
<BR>
<BR>
<B>レベル1：<FONT color="#0000FF">安全</FONT></B><BR>
<B><BR>
状況：</B><BR>
WinPTAの存在もログファイルの存在も第三者に知られていないが、ある程度、隠蔽された実行ファイル（トロイやワーム）に対する警戒がされている。<BR>
<B>ユーザのレベル：</B><BR>
単にウイルス検査をするだけではコンピュータは安全でないことを知っており、スタートアップフォルダのチェックやレジストリチェックを定期的にまたは発作的に行い、特に怪しい設定がなければ安全だと感じるようなユーザに対する運用例です。<BR>
あるいは時々プロセスチェックも行いますが、システムファイル名のプロセスなどに対しては（それが改ざんされている可能性を考慮することなく）特に警戒しない程度のレベルです。<BR>
警戒心は少々あるが、一方で、方法論としての「隠蔽ソフトに対する対策」までは技術的に持っていないレベルのユーザを指します。<BR>
<B>WinPTAの運用：</B><BR>
WinPTAはプロセスチェックによってしか見ることができませんので、プロセスまでくまなくチェックしていないレベルのユーザに対してはほとんど安全です。<BR>
（Windows2000以前では「Alt+Ctrl+Del」によってもプロセスをチェックできません。つまりそのバージョンを普通に利用しているユーザ、プログラマやサーバ管理者などのある程度の警戒心や技術を持っていないユーザに対しては、安全度レベル0になります）<BR>
WinPTAの隠蔽機能を最大限に活用すれば、このレベルのユーザに対しては特にWinPTAの存在自体がばれることなく運用できるでしょう。<BR>
最悪の場合でもWinPTAのプロセスを時々強制停止される程度で、特に警戒されていない限り、安全に運用を続けられます。<BR>
<BR>
<BR>
<B>レベル2：<FONT color="#006633">中程度に安全</FONT></B><BR>
<BR>
<B>状況：</B><BR>
WinPTAの存在もログファイルの存在も知られていないが、隠蔽された実行ファイルに対する対策が方法論として技術化されている。<BR>
<B>ユーザのレベル：</B><BR>
時々プロセスチェックを行い、見慣れないプロセスを逐一検査する程度のレベルのユーザです。<BR>
見慣れないプロセスのファイル名を検索に掛けてみて、それがトロイやワームであることがわかると、自動起動の設定を探し出して駆除できる程度です。<BR>
ただし、自分でそのファイル内容を逆アセンブルしてみたり、そのソフトのファイルアクセスを監視できるほどの技術は持っていません。<BR>
セキュリティ関係の警戒心が低くないタイプの「普通の」職業プログラマですと、この程度の知識とスキルを持っていると考えることができます。<BR>
<B>WinPTAの運用：</B><BR>
不審なプロセスであるということまで警戒されたレベルです。<BR>
WinPTAはトロイやワームではありませんので、実行ファイル名を「WinPTA.exe」以外に書き換えてしまえば、ファイル名検索などでこのソフトの特性を見破られることはありません。<BR>
WinPTAの起動偽装機能（Breeder.exe）を使えば、どこからこのプロセスが起動されているかを突き止めることも容易ではなく、スタートアップやレジストリに特別な起動が追加されてもいませんので、彼はこのプロセスに対してそれ以上の警戒をしない可能性が高いと思われます。<BR>
特別に警戒度を高めない限り、このレベルのユーザに対しては安全に運用できると言って良いでしょう。<BR>
もし彼がそれ以上に警戒して、レジストリを洗いざらいチェックしたりWinPTAのプロセスを強制終了させてみたりしながら、専用のツールを導入して対処してきた場合、最悪でWinPTA本体の存在を「それがWinPTAであるということはわからないままに」知る可能性はあります。<BR>
こうなった場合、WinPTAを削除されることで、それ以降のログファイルを残すことができなくなるでしょう。<BR>
ただし、それまでに取られたログファイルは大抵の場合安全ですし、ましてやログファイルの内容までは把握されないと考えられます。<BR>
<BR>
<BR>
<B>レベル3：<FONT color="#CC6600">安全度は低い</FONT></B><BR>
<BR>
<B>状況：</B><BR>
WinPTA本体が「あやしい何かしらのファイルである」ことが知られている。<BR>
<B>ユーザのレベル：</B><BR>
レベル2の最後のケースのように、WinPTA本体が発見され、かつそれが怪しいことが知られてしまったケースです。<BR>
または、ユーザがセキュリティに関する専門的な知識と技術を持っていて、全てのプロセスに対して自らある程度のコードをチェックするといったような場合です。<BR>
（ただし、例えば「普通の」職業プログラマがここまでの警戒心と技術を持っていることはまれです）<BR>
<B>WinPTAの運用：</B><BR>
このレベルの相手に対しては、WinPTAを運用する安全度は高くないと思ってください。<BR>
少なくとも、気づかれた後にログファイルを取り続けることは望めない場合がほとんどでしょう。<BR>
それ以前のログファイルについては、通常は安全でしょうが、ここまで相手の警戒心が高い場合は、場合によっては全ディレクトリの検査まで行う可能性もあります。<BR>
この場合、ログが発見されて、ファイル名などによっては削除されてしまうことがあります。<BR>
ログは暗号化されていますのでその段階ではそれ以上には危険（ログの解読の危険性）ではありません。<BR>
ただし、高い技術を持ったユーザがログを解読しようと試みる場合、WinPTA本体の挙動を逆アセンブルして完全に把握するか、または専用のクラックソフトを自作したりすることによって、可能かもしれません。<BR>
もっとも、このレベルの技術と警戒心を持つユーザは、そのような面倒なことをするまでもなく、WinPTAと同じような機能を持ったソフトを自作して既に自分のPC内で使用している可能性の方がまだ高いでしょう。<BR>
その場合、あなたがWinPTAを仕込んだ操作そのものが既に相手に知られているわけです（笑）。<BR>
このように、WinPTA本体の安全性をいくら高めても、相手がWinPTAを自作できる程度のレベルであれば、WinPTAの運用は既に安全ではないと考えられます。<BR>
また、高度な知識はなくとも警戒心がここまで高い相手であれば、何らかの対策（市販のログ記録ソフトの導入など）を行っている可能性もあり、上記と同様に「安全でない」と言えると思います。<BR>
<BR>
<BR>
<B>レベル4：<FONT color="#FF0000">危険</FONT></B><BR>
<B>状況：</B><BR>
WinPTAがWinPTAであることが突き止められていて、ログファイルの位置もわかっているような場合。<BR>
<B>ユーザのレベル：</B><BR>
非常に警戒心が高く、市販のログ記録ソフトを導入している場合や、非常に技術が高く、自力でWinPTAの存在を突き止めた上、その挙動の大部分を把握しているユーザ。<BR>
<B>WinPTAの運用：</B><BR>
WinPTA本体の挙動がわかったとしても、完全に把握されていない限りは、ログファイルを発見することも簡単ではありませんが、ここでは既に発見されたものとします。<BR>
この場合に望むことは、既にそれ以上のログを取ることではなく、過去のログを解読してWinPTAを流用し、他のユーザの操作ログを「盗聴」されないようなことです。<BR>
これに関してはWinPTAはログの暗号化がなされていますが、設定ファイル自体を解読されて鍵を見つけられてしまった場合は無力です。<BR>
警戒心が高いだけのユーザにはこの作業は不可能ですので、最悪の事態は避けられるでしょう。<BR>
しかし、高度な技術を持ったユーザがこれを目指した場合、不可能ではありません。最悪の場合の危険性も考慮した上で、WinPTAの運用を検討してください。<BR>
とはいえ、そのような高度な技術と警戒心を持ったユーザは、たぶんあなたがWinPTAを導入しようとするその操作そのものを、既に監視して見抜いていると思いますが・・・。<BR>
<BR>
<BR>
<B>レベル5：<FONT color="#FF0000">深刻な危険度</FONT></B><BR>
<B>状況：</B><BR>
ログファイルの解読がされる場合。<BR>
<B>ユーザのレベル：</B><BR>
少なくとも、ある種の実行ファイルからそのプログラムを理解できるレベルでなければ不可能です。<BR>
また、解読のために専用のプログラムを書く必要があるでしょう。<BR>
ただし、そこまで労力を使うくらいなら、WinPTAと同じ機能のソフトを作って「逆に仕掛けておく」方がずっと効率的で簡単です。<BR>
<B>WinPTAの運用：</B><BR>
不可能であるだけでなく、逆に悪用されると非常に危険です。<BR>
<BR>
<BR>
<BR>
<B><FONT size="+2">WinPTAの安全な運用の程度のまとめ</FONT></B><BR>
<BR>
簡単に総括すると、<BR>
「<BR>
警戒度が高いだけの相手に対する危険性とは、「ログが取れない危険」である（WinPTAを仕掛けたこと自体が責められる場合はその危険性も加味して下さい）。<BR>
技術が高く警戒心もある相手に対する危険性とは、「ログの逆用や、そもそもWinPTA導入自体を監視されてしまう危険」である（このような相手にはWinPTAは使えないでしょう）。<BR>
一般的な、特に警戒心を高めていない普通の職業プログラマに対するWinPTAの安全度は「中程度に安全か、安全」である。<BR>
PCを用いて通常の業務を行う程度の技術を持ったノーマルなユーザに対して、WinPTAは「安全」である。<BR>
定期的なウイルスチェックやファイアーウォールの導入、IEのActiveX等の設定以外にセキュリティ意識のないユーザ（ヤフーなどに掲載される最新のセキュリティ情報を知っている程度の普通のユーザ）に対しては「安全」である。<BR>
」<BR>
と言えるでしょう。<BR>
<BR>
<B>もしとつげき東北にWinPTAを仕掛けたらどの程度対処できるか</B><BR>
<BR>
例として、もし私がWinPTAというソフトを知らず、WinPTAの偽装機能をフルに使って私にWinPTAを仕掛けた場合に、（私が個人だけで対処しなければならないとして）私がどう対処できるかを書いておきます。<BR>
<BR>
私は定期的なプロセスチェックとウイルスチェック、およびいくつかのポートの監視によってPCの安全性を保とうとします。<BR>
しかしそれらはせいぜい、週に1回されるかどうかです。<BR>
したがって平均的に3～4日の間、WinPTAは正常に動作します（その間に一度でも重要なパスワード入力をしてしまった場合は、私は「危険」です）。<BR>
私はプロセスチェックによって不振なプロセスを発見します。<BR>
ファイル名検索によって、有名なトロイやワームでないかを確認します。<BR>
それは有名なトロイやワームではなく、爆発的な繁殖力を持った危険性のあるそれらではないことを知ります。<BR>
しかし明らかに「導入していないはずのプロセス」が増えているわけですから、警戒します。<BR>
レジストリやスタートアップなどの自動実行を調べます。<BR>
運がよければ<BR>
｛<BR>
「Breeder.exe（WinPTAに付属のファイル実行偽装ソフト）」を起動している設定を見つけるでしょう。そこを元通りに直します。<BR>
より重要度が高いと認識していれば、各ディレクトリへのアクセストラッププログラムを自作してWinPTAを実行してみたりするでしょうが、「ちょっと逆アセンブルして挙動のほとんどを把握してしまおう」というような技術は持っていません。<BR>
おそらく結果的には、単にWinPTAを除去できたというところまでで、あとはシステムファイルの書き換えチェックなどをしてみたり、「感染経路」を調べてみたりするでしょうが、特に得られるものはなく、危険度の把握に応じてシステムファイルのチェックとプロセスチェックを繰り返しながら、対処終了します。<BR>
ディレクトリへのアクセストラップが上手に働けば、ログファイルらしきものを発見できます。<BR>
しかし内容は暗号化されているので、「弱い暗号でないか」少し試行錯誤します（例えば安全な環境下でわざとWinPTAを起動してみて、入力とログ内容との関係を調べてみたりするかも知れません）。<BR>
実際には弱くないのでそのままログファイルらしきものを削除し、特にそれ以上の被害がないことを確認して対処終了します。<BR>
｝<BR>
運がよくなければ<BR>
｛<BR>
プロセスを閉じてみたり、プロセスがどのポートをオープンさせているか（またはいないか）を調べます（クラッカーがバックドアにしていないかのチェック）。<BR>
特に得られるものはなく、システムファイルの書き換えチェックや感染経路の特定を考えますが、同様に徒労に終わります。<BR>
どのタイミングでWinPTAのプロセスが起動されているかを、プロセス監視ソフトを場合によっては自作しておおむね突き止め、怪しい部分の自動起動を全て入れなおします。<BR>
危険度の把握に応じてシステムファイルのチェックとプロセスチェックを繰り返しながら、それ以上にワームが活動していないことを確認して、対処終了します。<BR>
｝<BR>
<BR>
いずれの場合も、ログファイルの内容までを突き止めるにはいたりません。<BR>
運がよければそれまでのログを消し去ることができ、その後のWinPTAの活動を止めることはできますが、そのソフトがWinPTAであることを明確にしたり、そのソフトがどのような活動を行っているかまでを具体的に把握するまではできません。<BR>
全体として「怪しいワームが入ってきていた」「自動実行のためにうまい偽装を使っていた」という感想を持ち、その後しばらくPCの挙動に厳重に警戒する程度に終わるでしょう。<BR>
状況が深刻だと判断すれば（例えば会社の自分のマシンが誰かに操作されている危険性）、逆にWinPTA的なソフトを自作または導入して「逆監視」したり、ログオンパスワードを変えたりすることはできます。<BR>
気づいてからは、ログが流出する危険に対しては対処できますが、気づくまでの間（警戒するまでの間）のログの流出は止められないかと思います。<BR>
それ以前に同様のことが社内で発生していたりするなら、それなりに事前に対処することはできたでしょう。そのあたりは事前の警戒度に依存します。<BR>
<BR>
<BR>
<BR>
<B><FONT size="+2">安全な運用の具体的方法</FONT></B><BR>
<BR>
上記安全基準を踏まえて、なるべく安全度が高まるように、具体的に留意する点についてまとめておきます。<BR>
<BR>
<B>・WinPTA本体の名称偽装</B><BR>
まずは、WinPTA本体を隠蔽する必要があります。<BR>
実行ファイル名「WinPTA.exe」では最悪です（笑）。<BR>
実行ファイル名は、それらしいシステムファイル名にしておくことをお勧めします。<BR>
ただし、そのファイル名が有名なワームの名前とかぶらないようにしましょう（そのファイル名で検索をかけてみて、セキュリティ関係のページがヒットしないようにします）。<BR>
<BR>
<B>・WinPTA本体の位置の隠蔽</B><BR>
個人的には「c:\windows\system\」の直下か、あるいは他の通常自動起動するexeファイルと同じ位置に置くべきだと考えています。<BR>
特に「Breeder.exe」を利用して、後者にするのが賢明です。<BR>
<BR>
<B>・WinPTA本体の偽装</B><BR>
WinPTAは現段階で有名ソフトではないので、ファイルサイズから「WinPTAを発見」する人はほとんどいないと思いますが、一応、付属の「FAT.exe」を用いてファイルサイズを適当に変化させておくと良いと思います。余力があれば、ファイル作成日時も変えておくと良いでしょう（そのようなツールはフリーでいくつか見つけられます）。<BR>
<BR>
<B>・WinPTA実行の偽装</B><BR>
Breeder.exeを用いることを推奨します。この専用アプリケーションについては後述します。<BR>
また、そうでなければ、スタートアップにショートカットを登録したり、レジストリやwin.iniやsystem.iniに自動実行を書き込むことになります。<BR>
相手が、そのあたりをチェックするレベルを持っている場合、レベル3（安全度は低い）になりますから、相手の技術に応じてどうするかを検討します。<BR>
一般的な企業の一般的なPC業務従事者であれば、レジストリチェックまでは行わないと思いますが。<BR>
<BR>
<B>・ログファイルの位置の偽装</B><BR>
せっかくWinPTA本体を巧妙に隠していても、ログファイルが堂々とデスクトップ上に作られるようでは、すぐにばれてしまいます（笑）。<BR>
ログファイルを作るフォルダは、なるべく奥の方の、通常見ないフォルダに設定します。<BR>
木を隠すなら森に隠すのが一番です。もともと大量のテンポラリファイルが作られたり消えたりするフォルダに置くのが良いと思います。<BR>
<BR>
<B>・ログファイルの偽装</B><BR>
ログファイルは必ず長い鍵長で暗号化し、またログ作成日付偽装機能を利用します。<BR>
何らかの原因でWinPTA本体が発見されたとき、もしログが暗号化されていなければすぐにログの内容を「解読」されますし、またログ作成日付が「今日」であれば、ファイル作成日付条件検索ですぐにログファイルが発見されてしまいます。<BR>
なお、ログファイルの鍵として数字のみの8ケタ暗号などはやめましょう。必ず、半角英数ランダムで10文字以上（およそ80bit）にします。もちろんもっと長くてもかまいません。<BR>
自作の「VNCrypt暗号クラックツール（ブルートフォースアタック）」にて数字8ケタのみのvncファイルをクラックしたところ、平均およそ1日弱で解読できました。<BR>
半角英数ランダムで10文字となると、このシステムでは一生かかっても解読できないでしょう。<BR>
<BR>
<BR>
<BR>
<B><FONT size="+1">擬装用付属アプリケーションの使用</FONT></B><BR>
<BR>
<B>「FAT.exe」</B><BR>
これを用いて、実行ファイルに冗長データを付加して、サイズを増加させられます。<BR>
WinPTA本体のファイル偽装に使えます。<BR>
ただし、ファイルの内容までをチェックしてWinPTAでないかを調べるソフトを作って調べた場合、これでは偽装できません。<BR>
<BR>
<BR>
<B>「Breeder.exe」</B><BR>
exeファイルの実行時に、exeファイルの実行を偽装するツールです。<BR>
コマンドラインパラメータとして<BR>
filename1 paramstr1 filename2 paramstr2<BR>
の４つのパラメータを与えてこのソフトを起動すると、このソフトは<BR>
filename1 filename2<BR>
の各々のファイル名で表されるexeファイルを起動して終了します。<BR>
これらの実行時引数として、各々<BR>
paramstr1 paramstr2<BR>
を与えます。ただし、paramstrとして&quot;_&quot;を与えた場合は、パラメータを与えないものとみなされます。<BR>
<BR>
つまり、まるで「Breeder.exe」だけを実行しているかに見せかけたショートカットから、実際には2つの異なるアプリケーションを起動することができます。<BR>
<BR>
例えば、もともと「notepad.exe」をスタートアップに登録している人がいたとします。<BR>
まずは、もともとの「notepad.exe」を「notepad~.exe」などに名称変更してしまいましょう。<BR>
その後、もともとnotepad.exeがあったフォルダに、Breeder.exeをコピーします。<BR>
そして、<FONT color="#FF0000">Breeder.exeを「notepad.exe」に名称変更</FONT>します（もちろん、<FONT color="#FF0000">決して「Breeder.exe」の名称のまま実行する設定にしない</FONT>でください）。<BR>
もともとのスタートアップ設定になっているショートカットのプロパティを<BR>
&quot;C:\･･･\notepad.exe&quot;<BR>
から<BR>
&quot;C:\･･･\notepad.exe&quot; &quot;notepad.exe&quot;
&quot;_&quot; &quot;WinPTA.exe&quot; &quot;free.ini&quot;<BR>
に変更します。<BR>
これで、ただ単にnotepadを起動しているつもりが、notepadとWinPTA.exeを同時に起動することになるわけです（このとき、notepadの方にはパラメータは与えず、WinPTAの方にはパラメータ&quot;free.ini&quot;を与えています）。<BR>
パラメータの指定法などに制限があり、また、一部のexeファイルの場合には使えませんが、かなり強力な偽装となります。<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
</P>
</BODY>
</HTML>
